<?xml version="1.0" encoding="UTF-8"?>
<sequence name="UpdateItem" trace="disable" xmlns="http://ws.apache.org/ns/synapse">
    <enrich description="Deploy item QTY untuk di olah">
        <source clone="false" property="items" type="property"/>
        <target type="body"/>
    </enrich>
    <foreach description="Foreach update item QTY" expression="json-eval($)" id="foreach-update-item-qty">
        <sequence>
            <payloadFactory media-type="json">
                <format>        
                    { 
			            "selling_id": "$1",
			            "item_id": "$2"			            
			            
			        }
		        </format>
                <args>
                    <arg evaluator="xml" expression="get-property('id_selling')"/>
                    <arg evaluator="xml" expression="get-property('id_item')"/>
                </args>
            </payloadFactory>
            <property description="Success" expression="get-property('item_id')" name="id_item" scope="default" type="STRING"/>
            <log description="Log start" level="custom">
                <property expression="get-property('id_item')" name="test get data array item id ke 2"/>
            </log>
        </sequence>
    </foreach>
    <log description="Log start" level="custom">
        <property expression="get-property('id_selling')" name="get selling_id for update qty item"/>
        <property expression="get-property('id_item')" name="get item_id for update qty item"/>
    </log>
    <property description="Get result" expression="json-eval($)" name="updateItemQTY" scope="default" type="STRING"/>
    <payloadFactory media-type="json">
        <format>
      		{
				"updateItemQty": {
			    	"updateItemQTY": $1
			  	}
			}
		</format>
        <args>
            <arg evaluator="xml" expression="get-property('updateItemQTY')"/>
        </args>
    </payloadFactory>
    <property name="messageType" scope="axis2" type="STRING" value="application/json"/>
    <property description="Data Items" expression="json-eval($.return)" name="updateItemQTY" scope="default" type="STRING"/>
    <enrich description="Deploy item untuk di olah">
        <source clone="false" property="updateItemQTY" type="property"/>
        <target type="body"/>
    </enrich>
    <!--  <log description="Log start" level="custom">
            <property expression="get-property('updateItemQTY')" name="test update Item QTY"/>
        </log> -->
    <dataServiceCall description="update Item QTY" serviceName="LoccanaSellingDataService">
        <source type="body"/>
        <target type="body"/>
    </dataServiceCall>
</sequence>
