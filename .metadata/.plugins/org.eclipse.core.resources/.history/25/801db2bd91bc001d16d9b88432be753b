<?xml version="1.0" encoding="UTF-8"?>
<sequence name="UpdateItem" trace="disable" xmlns="http://ws.apache.org/ns/synapse">
    <!--  			<property description="get selling_id" expression="get-property('uri.var.selling_id')" name="selling_id" scope="default" type="STRING"/> -->
    <!--             <property description="get selling_id" expression="get-property('uri.var.item_id')" name="item_id" scope="default" type="STRING"/> -->
    <!--             <propertyGroup description="Parameter Update"> -->
    <!--                 <property expression="get-property('uri.var.selling_id')" name="selling_id" scope="default" type="STRING"/> -->
    <!--                 <property expression="get-property('uri.var.item_id')" name="item_id" scope="default" type="STRING"/> -->
    <!--                 <property expression="get-property('SYSTEM_DATE', 'yyyy-MM-dd HH:mm:ss')" name="currentDate" scope="default" type="STRING"/> -->
    <!--                 <property expression="json-eval($.id_user)" name="id_user" scope="default" type="STRING"/> -->
    <!--                 <property name="menu" scope="default" type="STRING" value="Item QTY"/> -->
    <!--                 <property name="aktivitas" scope="default" type="STRING" value="Update"/> -->
    <!--             </propertyGroup>             -->
    <payloadFactory media-type="json">
        <format>        
                    { 
			            "selling_id" : "$1",
						"item_id" : "$2"				
			        }
		        </format>
        <args>
            <arg evaluator="xml" expression="get-property('sellingsId')"/>
            <arg evaluator="xml" expression="get-property('item_id')"/>
        </args>
    </payloadFactory>
    <property description="Get result" expression="json-eval($)" name="updateItemQTY" scope="default" type="STRING"/>
    <payloadFactory media-type="json">
        <format>
      		{
				"getSellingIDforUpdateItem": {
			    	"updateItemQTY": $1
			  	}
			}
		</format>
        <args>
            <arg evaluator="xml" expression="get-property('updateItemQTY')"/>
        </args>
    </payloadFactory>
    <property name="messageType" scope="axis2" type="STRING" value="application/json"/>
    <property description="Data Items" expression="json-eval($.return)" name="updateItemQTY" scope="default" type="STRING"/>
    <log description="Log start" level="custom">
        <property expression="get-property('updateItemQTY')" name="test update Item QTY"/>
    </log>
    <dataServiceCall description="update Item Qty" serviceName="LoccanaSellingDataService">
        <source type="body"/>
        <target type="body"/>
    </dataServiceCall>
    <!--  <log description="Log start" level="custom">
                <property expression="get-property('selling_id')" name="get selling_id for update qty item"/>
                <property expression="get-property('item_id')" name="get item_id for update qty item"/>
            </log>
            <sequence key="LoccanaSellingIDForUpdateItemQTY"/>
            <filter regex="false" source="boolean(get-property('data'))">
                <then>
                    <property description="Error Message" name="message" scope="default" type="STRING" value="selling details tidak ditemukan."/>
                    <sequence key="LoccanaSellingGetResponseError"/>
                </then>
                <else>
                    <property action="remove" name="data" scope="default"/>
                </else>
            </filter>
            <dataServiceCall description="update item qty" serviceName="LoccanaSellingDataService">
                <operations type="single">
                    <operation name="updateItemQty">
                        <param evaluator="xml" expression="get-property('selling_id')" name="selling_id"/>
                        <param evaluator="xml" expression="get-property('item_id')" name="item_id"/>
                    </operation>
                </operations>
                <source type="inline"/>
                <target type="body"/>
            </dataServiceCall>
             <log description="Log start" level="custom">
                <property expression="get-property('base_qty')" name="base_qty"/>
                <property expression="get-property('qty')" name="qty"/>
            </log>
            <property name="messageType" scope="axis2" type="STRING" value="application/json"/>
            <property description="Get update status" expression="json-eval($.UpdatedRowCount.id)" name="result" scope="default" type="STRING"/>
            <log description="Log start" level="custom">
                <property expression="get-property('result')" name="debug"/>
            </log>
            <filter regex="true" source="boolean(get-property('result'))">
                <then>
                    <property description="Success Message" name="message" scope="default" type="STRING" value="Update item qty berhasil."/>
                    <property description="Success data" expression="get-property('selling_id')" name="data" scope="default" type="STRING"/>
                    <sequence key="SellingUserActivities"/>
                    <sequence key="LoccanaSellingGetResponseSuccess"/>
                </then>
                <else>
                    <property description="Error Message" name="message" scope="default" type="STRING" value="Update item qty gagal."/>
                    <sequence key="SellingUserActivities"/>
                    <sequence key="LoccanaSellingGetResponseError"/>
                </else>
            </filter> -->
</sequence>
