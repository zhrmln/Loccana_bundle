<data transports="http https" serviceGroup="" serviceNamespace="" name="LoccanaSellingDataService">
  <description />
<!--   BEGIN CONNCETION DATABASE -->
 <!--  <config id="DataSourceSelling">
    <property name="driverClassName">com.mysql.jdbc.Driver</property>
    <property name="url">jdbc:mysql://194.233.88.96:3306/loccana_selling</property>
    <property name="username">dbase</property>
    <property name="password">loccana</property>
  </config>
  <config id="DataSourceMasterData">
    <property name="driverClassName">com.mysql.jdbc.Driver</property>
    <property name="url">jdbc:mysql://194.233.88.96:3306/loccana_masterdata</property>
    <property name="username">dbase</property>
    <property name="password">loccdsaana</property>
  </config>
  <config id="DataSourceInventory">
    <property name="driverClassName">com.mysql.jdbc.Driver</property>
    <property name="url">jdbc:mysql://194.233.88.96:3306/loccana_inventory</property>
    <property name="username">dbase</property>
    <property name="password">loccana</property>
  </config> -->
  <!--  END CONNECTION DATABASE -->
  
<!--   START CONNECTION TO SERVER WSO2 -->
    <config id="DataSourceSelling">
    <property name="driverClassName">com.mysql.jdbc.Driver</property>
    <property name="url">jdbc:mysql://161.97.171.156:3306/loccana_selling</property>
    <property name="username">admindb</property>
    <property name="password">Sukaluyu2931!#</property>
  </config>
  <config id="DataSourceMasterData">
    <property name="driverClassName">com.mysql.jdbc.Driver</property>
    <property name="url">jdbc:mysql://161.97.171.156:3306/loccana_masterdata</property>
    <property name="username">admindb</property>
    <property name="password">Sukaluyu2931!#</property>
  </config>
  <config id="DataSourceInventory">
    <property name="driverClassName">com.mysql.jdbc.Driver</property>
    <property name="url">jdbc:mysql://161.97.171.156:3306/loccana_inventory</property>
    <property name="username">admindb</property>
    <property name="password">Sukaluyu2931!#</property>
  </config>
<!-- END CONNECTION To SERVER WSO2 -->

<!-- BEGAN QUERY USER ACTIVITIES FOR MASTERDATA -->
	<query id="createUserActivitiesQuery" keyColumns="id" returnGeneratedKeys="true" useConfig="DataSourceMasterData">
	   <sql>INSERT INTO
	  user_activities ( 
	    id_user,
	    menu,
	    aktivitas,
	    
	    keterangan,
	    created_at,
	    updated_at
	  )
	VALUES
	  (
	    :id_user,
	    :menu,
	    :aktivitas,
	    :keterangan,
	    :created_at,
	    :updated_at
	  )
	</sql>
	   <param name="id_user" sqlType="STRING" />
	   <param name="menu" sqlType="STRING" />
	   <param name="aktivitas" sqlType="STRING" />
	   <param name="keterangan" sqlType="STRING" />
	   <param name="created_at" sqlType="STRING" />
	   <param name="updated_at" sqlType="STRING" />
	   <result useColumnNumbers="true" element="return">
	     <element name="id" xsdType="integer" column="1" />
	   </result>
	 </query>
	  <query id="getUserActivitiesDetailQuery" useConfig="DataSourceMasterData">
	    <sql>SELECT
		  id,
		  menu,
		  aktivitas,
		  keterangan,
		  created_at,
		  updated_at
		FROM
		  user_activities
		WHERE
		  id = :id
		</sql>
	    <param name="id" sqlType="STRING" paramType="SCALAR" />
	    <result outputType="json">{
		  "data": {
		    "id": "$id",
		    "id_user": "$id_user",
		    "menu": "$menu",
		    "aktivitas": "$aktivitas",
		    "keterangan": "$keterangan",
		    "created_at": "$created_at",
		    "updated_at": "$updated_at"
		  }
		}</result>
	  </query>
<!-- 	 END USER ACTIVITIES -->
 
<!--  BEGIN QUERY LOCCANA SELLING -->
  <query id="getLimitOffsetSellingQuery" useConfig="DataSourceSelling">
    <sql>
		   SELECT
		  a.id AS id_penjualan,
		  a.total_amount,
		  a.`no_selling`,
		  c.`name`,
		  DATE_FORMAT(a.date_selling, "%Y-%m-%d %H:%i:%s") AS date_selling,
		  b.`price`,
		  a.`term_of_payment`,
		  d.`name` AS nama_sales,
		  IFNULL(a.status, " ") AS status,
		  DATE_FORMAT(a.delivery_date, "%Y-%m-%d %H:%i:%s") AS delivery_date
		FROM
		  `loccana_selling`.`selling` a
		  JOIN `loccana_selling`.`selling_details` b ON a.`id` = b.`selling_id`
		  JOIN `loccana_masterdata`.`partners` c ON a.`partner_id` = c.`id`
		  JOIN `loccana_masterdata`.`users` d ON a.`sales_id` = d.`id`
		WHERE
		  a.status != 0
		  OR month (a.date_selling) like CONCAT ('%', :month, '%')
		  OR year(a.date_selling) like CONCAT('%', :year, '%')
		  OR (
		    a.no_selling like CONCAT('%', :search, '%')
		    OR c.name like CONCAT('%', :search, '%')
		  )
		ORDER BY
		  a.`date_selling` desc
		limit :limit
		offset :offset
	</sql>
    <param name="month" sqlType="STRING" paramType="SCALAR" />
    <param name="year" sqlType="STRING" paramType="SCALAR" />
    <param name="search" sqlType="STRING" paramType="SCALAR" />
    <param name="offset" sqlType="INTEGER" paramType="SCALAR" />
    <param name="limit" sqlType="INTEGER" paramType="SCALAR" />
    <result outputType="json">{
    "data":{ 
	    	"selling": 
	    	[
		    	{
		    		"id_penjualan":"$id_penjualan",
		            "total_amount":"$total_amount",
		            "no_selling":"$no_selling",
		            "name":"$name",
		            "date_selling":"$date_selling",
		            "price":"$price",
		            "term_of_payment":"$term_of_payment",
		            "nama_sales":"$nama_sales",
		            "status":"$status",
		            "delivery_date":"$delivery_date"
		         }
	    	]
      }   
            
   }</result>
  </query>
  <query id="getsellingCountSumPriceQuery" useConfig="DataSourceSelling">
    <sql>
   			SELECT
				  COUNT(selling.id) AS countid,
				  IFNULL(SUM(IFNULL(selling.total_amount, 0)), 0) AS sum_total_amount
				FROM
				  loccana_selling.selling AS selling
				  LEFT JOIN loccana_masterdata.partners lmp ON selling.partner_id = lmp.id
				WHERE
				  selling.status != 0
				  OR month (selling.date_selling) like CONCAT ('%' :month, '%')
				  OR year(selling.date_selling) like CONCAT('%', :year, '%')
				  OR (
				    selling.no_selling like CONCAT('%', :search, '%')
				    OR lmp.name like CONCAT('%', :search, '%')
				  )    			
		</sql>
    <param name="month" sqlType="STRING" paramType="SCALAR" />
    <param name="year" sqlType="STRING" paramType="SCALAR" />
    <param name="search" sqlType="STRING" paramType="SCALAR" />
    <result outputType="json">
	    	{
			   "data":{
			            "countid":"$countid",
			            "sum_total_amount":"$sum_total_amount"
			   }
			}
		</result>
  </query>
  <query id="createSellingsQuery" keyColumns="id" returnGeneratedKeys="true" useConfig="DataSourceSelling">
    <sql>INSERT INTO
	     `selling` 
		     (
		     `sales_id`,
		     `no_selling`,
		     `date_selling`,
		     `delivery_date`,
		     `partner_id`,
		     `term_of_payment`,
		     `total_amount`,
		     `coa_id`,
		     `payment_coa`,
		     `currency_id`,
		     `rate`,
		     `tax`,
		     `seq_n`,
		     `created_at`,
		     `updated_at`
		     )
		values 
			(
			:sales_id,
			:no_selling,
			:date_selling,
			:delivery_date,
			:partner_id,
			:term_of_payment,
			:total_amount,
			:coa_id,
			:payment_coa,
			:currency_id,
			:rate,
			:tax,
			:seq_n,
			:created_at,
			:updated_at
			)
	</sql>
    <param name="sales_id" sqlType="STRING" paramType="SCALAR" />
    <param name="no_selling" sqlType="STRING" paramType="SCALAR" />
    <param name="date_selling" sqlType="STRING" paramType="SCALAR" />
    <param name="delivery_date" sqlType="STRING" paramType="SCALAR" />
    <param name="partner_id" sqlType="STRING" paramType="SCALAR" />
    <param name="term_of_payment" sqlType="STRING" paramType="SCALAR" />
    <param name="total_amount" sqlType="STRING" paramType="SCALAR" />
    <param name="coa_id" sqlType="STRING" paramType="SCALAR" />
    <param name="payment_coa" sqlType="STRING" paramType="SCALAR" />
    <param name="currency_id" sqlType="STRING" paramType="SCALAR" />
    <param name="rate" sqlType="STRING" paramType="SCALAR" />
    <param name="tax" sqlType="STRING" paramType="SCALAR" />
    <param name="seq_n" sqlType="STRING" paramType="SCALAR" />
    <param name="created_at" sqlType="STRING" paramType="SCALAR" />
    <param name="updated_at" sqlType="STRING" paramType="SCALAR" />
    <result element="return" useColumnNumbers="true">
      <element name="id" column="1" xsdType="integer" />
    </result>
  </query>
  <query id="getSellingsDetailQuery" useConfig="DataSourceSelling">
    <sql>
    select 
	    id,
	    sales_id,
	    no_selling,
	    date_selling,
	    delivery_date,
	    DATE_FORMAT(created_at, "%Y-%m-%d %H:%i:%s") AS created_at,
	  	DATE_FORMAT(updated_at, "%Y-%m-%d %H:%i:%s") AS updated_at
    from 
    	selling 
    where id = :id</sql>
    <param name="id" sqlType="STRING" paramType="SCALAR" />
    <result outputType="json">{
    "data":{
            "id":"$id",
            "sales_id":"$sales_id",
            "no_selling":"$no_selling",
            "date_selling":"$date_selling",
            "delivery_date":"$delivery_date",
            "created_at":"$created_at",
            "updated_at":"$updated_at"
            }
   }</result>
  </query>
  <query id="deleteSellingsQuery" useConfig="DataSourceSelling" returnUpdatedRowCount="true">
    <sql>
    	DELETE a,b,c
		FROM `selling` a
		LEFT JOIN `selling_details` b ON a.id = b.`selling_id`
		LEFT JOIN `loccana_inventory`.`mutations` c ON b.`mutation_id`=c.`id`
		WHERE a.id = :id</sql>
    <param name="id" sqlType="STRING" paramType="SCALAR" />
    <result element="UpdatedRowCount" useColumnNumbers="true">
      <element name="id" column="1" xsdType="integer" requiredRoles="" />
    </result>
  </query>
  <query id="getSellingsListQuery" useConfig="DataSourceSelling">
    <sql>
    	SELECT 
		    a.id AS id_penjualan, 
		    a.total_amount, 
		    a.`no_selling`,
		    c.`name`,
		    DATE_FORMAT(a.`date_selling`, "%Y-%m-%d %H:%i:%s") AS date_selling,
		    b.`price`,
		    a.`term_of_payment`,
		    d.`name` AS nama_sales,
		    IFNULL(a.status, " ") AS status,
		    DATE_FORMAT(a.delivery_date, "%Y-%m-%d %H:%i:%s") AS delivery_date
			FROM `loccana_selling`.`selling` a
			JOIN `loccana_selling`.`selling_details` b ON a.`id`=b.`selling_id`
			JOIN `loccana_masterdata`.`partners` c ON a.`partner_id`=c.`id`
			JOIN `loccana_masterdata`.`users` d ON a.`sales_id`=d.`id` 
			GROUP BY a.`id` order by a.`date_selling` desc
	</sql>
    <result outputType="json">{
	"data":{
		"selling": [
				{
				"id_penjualan": "$id_penjualan", 
				"total_amount":"$total_amount", 
				"no_selling":"$no_selling", 
				"name": "$name", 
				"date_selling": "$date_selling", 
				"price": "$price", 
				"term_of_payment": "$term_of_payment", 
				"nama_sales": "$nama_sales", 
				"status": "$status", 
				"delivery_date": "$delivery_date"
				}
			]
			
		}
}</result>
  </query>
  <query id="updateSellingsQuery" useConfig="DataSourceSelling" returnUpdatedRowCount="true">
    <sql>
    	UPDATE `loccana_selling`.`selling` 
	LEFT JOIN `loccana_selling`.`selling_details` ON `loccana_selling`.`selling`.`id`=`loccana_selling`.`selling_details`.`selling_id`
	JOIN `loccana_masterdata`.`items` ON `loccana_selling`.`selling_details`.`item_id`=`loccana_masterdata`.`items`.`id`
	JOIN `loccana_masterdata`.`item_qty` ON `loccana_masterdata`.`items`.`id`=`loccana_masterdata`.`item_qty`.`item_id`
	JOIN `loccana_inventory`.`mutations` ON `loccana_selling`.`selling_details`.`mutation_id`=`loccana_inventory`.`mutations`.`id`
	SET 
		`date_selling`=:date_selling,
		`term_of_payment`=term_of_payment,
		`delivery_date`=:delivery_date,
		`total_amount`=:total_amount,
		`unit_price`=:unit_price,
		`loccana_selling`.`selling_details`.`item_id`=:item_idA,
		qty=:qty,
		qty_box=:qty_box,	
		`qty_satuan`=:qty_satuan,
		`box_amount`=:box_amount,
		`price`=:price,
		`discount`=:discount,
		`loccana_selling`.`selling_details`.`notes`=:notes,
		date_mutation=:date_mutation,
		amount_mutation=:amount_mutation,
		`loccana_inventory`.`mutations`.`item_id`=:item_id
		 WHERE
		 `loccana_selling`.`selling`.id=:id

    </sql>
    <param name="date_selling" sqlType="STRING" paramType="SCALAR" />
    <param name="term_of_payment" sqlType="STRING" paramType="SCALAR" />
    <param name="delivery_date" sqlType="STRING" paramType="SCALAR" />
    <param name="total_amount" sqlType="STRING" paramType="SCALAR" />
    <param name="unit_price" sqlType="STRING" paramType="SCALAR" />
    <param name="item_idA" sqlType="STRING" paramType="SCALAR" />
    <param name="qty" sqlType="STRING" paramType="SCALAR" />
    <param name="qty_box" sqlType="STRING" paramType="SCALAR" />
    <param name="qty_satuan" sqlType="STRING" paramType="SCALAR" />
    <param name="box_amount" sqlType="STRING" paramType="SCALAR" />
    <param name="price" sqlType="STRING" paramType="SCALAR" />
    <param name="discount" sqlType="STRING" paramType="SCALAR" />
    <param name="notes" sqlType="STRING" paramType="SCALAR" />
    <param name="date_mutation" sqlType="STRING" paramType="SCALAR" />
    <param name="amount_mutation" sqlType="STRING" paramType="SCALAR" />
    <param name="item_id" sqlType="STRING" paramType="SCALAR" />
    <param name="id" sqlType="STRING" paramType="SCALAR" />
    <result element="UpdatedRowCount" useColumnNumbers="true">
      <element name="id" column="1" xsdType="integer" />
    </result>
  </query>
  <query id="getSellingsIdQuery" useConfig="DataSourceSelling">
    <sql>
		SELECT 
	a.id AS id_penjualan,
	a.`no_selling`,
	DATE_FORMAT(a.`delivery_date`, "%Y-%m-%d %H:%i:%s") AS delivery_date,
	DATE_FORMAT(a.`date_selling`, "%Y-%m-%d %H:%i:%s") AS date_selling,
	b.`id` as selling_detail_id,
	b.mutation_id,
	c.`id` as cust_id,
	c.`code`,
	c.`name`,
	c.`address`,
	c.`phone`,
	c.`email`,
	c.`ship_address`,
	c.`fax`,
	a.`term_of_payment`,
	IFNULL(a.`description`, " ") AS description,
	f.`id` as item_id,
	f.`item_code`,
	f.`item_name`,
	f.`vat`,
	b.`qty`,
	b.`qty_satuan`,
	b.`qty_box`,
	b.`price`,
	b.`unit_price`,
	g.`unit_box` as qty_per_box,
	g.base_qty as stock

	FROM `loccana_selling`.`selling` a
	JOIN `loccana_selling`.`selling_details` b ON a.`id`=b.`selling_id`
	JOIN `loccana_masterdata`.`partners` c ON a.`partner_id`=c.`id`
	JOIN `loccana_masterdata`.`users` d ON a.`sales_id`=d.`id` 
	JOIN `loccana_masterdata`.`items` f ON b.`item_id`=f.id
	JOIN `loccana_masterdata`.`item_qty` g ON f.`id`=g.`item_id`
	where a.id= :id    
    </sql>
    <param name="id" sqlType="STRING" paramType="SCALAR" />
    <result outputType="json">{
	"data":{
		"selling": [
				{
						"id_penjualan":"$id_penjualan",
						"no_selling":"$no_selling",
						"delivery_date":"$delivery_date",
						"date_selling":"$date_selling",
						"selling_detail_id":"$selling_detail_id",
						"mutation_id":"$mutation_id",
						"cust_id":"$cust_id",
						"code":"$code",
						"name":"$name",
						"address":"$address",
						"phone":"$phone",
						"email":"$email",
						"ship_address":"$ship_address",
						"fax":"$fax",
						"term_of_payment":"$term_of_payment",
						"description":"$description",
						"item_id":"$item_id",
						"item_code":"$item_code",
						"item_name":"$item_name",
						"vat":"$vat",
						"qty":"$qty",
						"qty_satuan":"$qty_satuan",
						"qty_box":"$qty_box",
						"price":"$price",
						"unit_price":"$unit_price",
						"qty_per_box":"$qty_per_box",
						"stock":"$stock"
				}
			]
			
		}
}</result>
  </query>
 
  <query id="approveSellingsQuery" useConfig="DataSourceSelling" returnUpdatedRowCount="true">
    <sql>
    	UPDATE `selling`
	LEFT JOIN `selling_details` ON `selling`.`id`=`selling_details`.`selling_id`
	SET 
		`status`=:status,
		`approval_date`=:approval_date ,
		`approval_by`=:approved_by
		 WHERE
		 `selling`.id=:id
    </sql>
    <param name="status" sqlType="STRING" paramType="SCALAR" />
    <param name="approval_date" sqlType="STRING" paramType="SCALAR" />
    <param name="approved_by" sqlType="STRING" paramType="SCALAR" />
    <param name="id" sqlType="STRING" paramType="SCALAR" />
    <result element="UpdatedRowCount" useColumnNumbers="true" rowName="">
      <element name="id" column="1" xsdType="integer" />
    </result>
  </query>
<!--   END QUERY LOCCANA SELLING -->

<!-- BEGIN QUERY LOCCANA SELLING REPORT -->
<query id="getSellingReportQuery" useConfig="DatasourceMasterData">
    <sql>
		SELECT 
		c.item_code AS Kode_produk, 
		c.item_name AS Produk,
		concat(name,"",base_qty) as Kemasan,
		SUM(b.qty) AS Sum_of_pcs,
		SUM(b.qty)*(d.base_qty/f.convertion) AS Sum_of_ltkg,
		SUM(b.unit_price*b.qty)-(SUM(b.unit_price*b.qty)-(SUM(b.unit_price*b.qty)/a.tax)) AS Sum_of_total,
		(b.unit_price*b.qty)/a.tax AS Sum_of_ppn,
		(b.unit_price*b.qty) AS Sum_of_TotPPN,
		g.`buy_price` AS Average_of_Harga_Pokok,
		AVG(b.unit_price*b.qty)/b.qty AS Average_HargaKemasan,
		AVG(b.unit_price*b.qty)/b.qty*(1000/d.base_qty)AS Average_Hargalt,
		(b.unit_price*b.qty)-((b.unit_price*b.qty)/a.tax)-(SUM(b.unit_price*b.discount/100)) AS Sum_of_total_diskon,
		AVG(b.unit_price*b.qty)/b.qty*(1000/d.base_qty)-(g.`buy_price`) AS laba_rugi,
		((AVG(b.unit_price*b.qty)/b.qty*(1000/d.base_qty)-(g.`buy_price`))/g.`buy_price`)*100 AS persen,
		(SUM(b.qty)*(d.base_qty/1000))*(AVG(b.unit_price*b.qty)/b.qty*(1000/d.base_qty)-(g.`buy_price`)) AS labarugi_produk,
		DATE_DORMAT(a.date_selling, "%Y-%m-%d %H:%i:%s") AS date_selling
		FROM loccana_selling.`selling`a
		LEFT JOIN loccana_selling.`selling_details` b ON a.`id`=b.`selling_id`
		LEFT JOIN loccana_masterdata.`items` c ON c.`id`=b.`item_id`
		LEFT JOIN loccana_masterdata.`item_qty` d ON c.`id`=d.`item_id`
		LEFT JOIN loccana_masterdata.`uom` e ON c.`uom_id`=e.`id`
		LEFT JOIN loccana_masterdata.`uom_convert` f ON e.`id`=f.`uom_id`
		LEFT JOIN loccana_masterdata.`item_price` g ON c.id=g.item_id
        where it.status = 0 OR month (a.date_selling) like CONCAT ('%', :month, '%') OR year(a.date_selling) like CONCAT('%', :year, '%') OR c.item_name like CONCAT('%', :search, '%') order by g.buy_price DESC limit :limit offset :offset
      </sql>
	  <param name="month" sqlType="STRING" paramType="SCALAR" />
      <param name="year" sqlType="STRING" paramType="SCALAR" />
      <param name="search" paramType="SCALAR" sqlType="STRING" />
      <param name="offset" paramType="SCALAR" sqlType="INTEGER" />
      <param name="limit" paramType="SCALAR" sqlType="INTEGER" />
      <result outputType="json">{
       "data":{
		"report": [
				{
						"Kode_produk":"$Kode_produk",
						"Produk":"$Produk",
						"Kemasan":"$Kemasan",
						"Sum_of_pcs":"$Sum_of_pcs",
						"Sum_of_ltkg":"$Sum_of_ltkg",
						"Sum_of_total":"$Sum_of_total",
						"Sum_of_ppn":"$Sum_of_ppn",
						"Sum_of_TotPPN":"$Sum_of_TotPPN",
						"Average_of_Harga_Pokok":"$Average_of_Harga_Pokok",
						"Average_HargaKemasan":"$Average_HargaKemasan",
						"Average_Hargalt":"$Average_Hargalt",
						"Sum_of_total_diskon":"$Sum_of_total_diskon",
						"laba_rugi":"$laba_rugi",
						"persen":"$persen",
						"labarugi_produk":"$labarugi_produk"
				}
			]
			
		}
    }
    </result>
    </query>

<query id="getSellingReportNotFilteredQuery" useConfig="DatasourceMasterData">
    <sql>SELECT 
		c.item_code AS Kode_produk, 
		c.item_name AS Produk,
		concat(name,"",base_qty) as Kemasan,
		SUM(b.qty) AS Sum_of_pcs,
		SUM(b.qty)*(d.base_qty/f.convertion) AS Sum_of_ltkg,
		SUM(b.unit_price*b.qty)-(SUM(b.unit_price*b.qty)-(SUM(b.unit_price*b.qty)/a.tax)) AS Sum_of_total,
		(b.unit_price*b.qty)/a.tax AS Sum_of_ppn,
		(b.unit_price*b.qty) AS Sum_of_TotPPN,
		g.`buy_price` AS Average_of_Harga_Pokok,
		AVG(b.unit_price*b.qty)/b.qty AS Average_HargaKemasan,
		AVG(b.unit_price*b.qty)/b.qty*(1000/d.base_qty)AS Average_Hargalt,
		(b.unit_price*b.qty)-((b.unit_price*b.qty)/a.tax)-(SUM(b.unit_price*b.discount/100)) AS Sum_of_total_diskon,
		AVG(b.unit_price*b.qty)/b.qty*(1000/d.base_qty)-(g.`buy_price`) AS laba_rugi,
		((AVG(b.unit_price*b.qty)/b.qty*(1000/d.base_qty)-(g.`buy_price`))/g.`buy_price`)*100 AS persen,
		(SUM(b.qty)*(d.base_qty/1000))*(AVG(b.unit_price*b.qty)/b.qty*(1000/d.base_qty)-(g.`buy_price`)) AS labarugi_produk,
		DATE_DORMAT(a.date_selling, "%Y-%m-%d %H:%i:%s") AS date_selling
		FROM loccana_selling.`selling`a
		LEFT JOIN loccana_selling.`selling_details` b ON a.`id`=b.`selling_id`
		LEFT JOIN loccana_masterdata.`items` c ON c.`id`=b.`item_id`
		LEFT JOIN loccana_masterdata.`item_qty` d ON c.`id`=d.`item_id`
		LEFT JOIN loccana_masterdata.`uom` e ON c.`uom_id`=e.`id`
		LEFT JOIN loccana_masterdata.`uom_convert` f ON e.`id`=f.`uom_id`
		LEFT JOIN loccana_masterdata.`item_price` g ON c.id=g.item_id
        limit :limit offset :offset
      </sql>
      <param name="offset" paramType="SCALAR" sqlType="INTEGER" />
      <param name="limit" paramType="SCALAR" sqlType="INTEGER" />
      <result outputType="json">{
       "data":{
           "report":[
             {
                  "Kode_produk":"$Kode_produk",
						"Produk":"$Produk",
						"Kemasan":"$Kemasan",
						"Sum_of_pcs":"$Sum_of_pcs",
						"Sum_of_ltkg":"$Sum_of_ltkg",
						"Sum_of_total":"$Sum_of_total",
						"Sum_of_ppn":"$Sum_of_ppn",
						"Sum_of_TotPPN":"$Sum_of_TotPPN",
						"Average_of_Harga_Pokok":"$Average_of_Harga_Pokok",
						"Average_HargaKemasan":"$Average_HargaKemasan",
						"Average_Hargalt":"$Average_Hargalt",
						"Sum_of_total_diskon":"$Sum_of_total_diskon",
						"laba_rugi":"$laba_rugi",
						"persen":"$persen",
						"labarugi_produk":"$labarugi_produk"
              }
            ]
       }
    }
    </result>
    </query>
	<query id="getSelingReportCountQuery" useConfig="DatasourceMasterData">
    <sql>SELECT COUNT(*) AS countid
			FROM loccana_selling.`selling`a
			LEFT JOIN loccana_selling.`selling_details` b ON a.`id`=b.`selling_id`
			LEFT JOIN loccana_masterdata.`items` c ON c.`id`=b.`item_id`
			LEFT JOIN loccana_masterdata.`item_qty` d ON c.`id`=d.`item_id`
			LEFT JOIN loccana_masterdata.`uom` e ON c.`uom_id`=e.`id`
			LEFT JOIN loccana_masterdata.`uom_convert` f ON e.`id`=f.`uom_id`
			LEFT JOIN loccana_masterdata.`item_price` g ON c.id=g.item_id 
      WHERE month (a.date_selling) like CONCAT ('%' :month, '%') OR year(a.date_selling) like CONCAT('%', :year, '%') c.name like CONCAT('%',:search,'%')
  </sql>
    <param name="search" paramType="SCALAR" sqlType="STRING" />
    <result outputType="json">{
       "data_filtered":{
            "countid":"$countid"
       }
  }
  </result>
  </query>

   <query id="getSellingReportCountNotFilteredQuery" useConfig="DatasourceMasterData">
    <sql>SELECT COUNT(*) AS countid
			FROM loccana_selling.`selling`a
			LEFT JOIN loccana_selling.`selling_details` b ON a.`id`=b.`selling_id`
			LEFT JOIN loccana_masterdata.`items` c ON c.`id`=b.`item_id`
			LEFT JOIN loccana_masterdata.`item_qty` d ON c.`id`=d.`item_id`
			LEFT JOIN loccana_masterdata.`uom` e ON c.`uom_id`=e.`id`
			LEFT JOIN loccana_masterdata.`uom_convert` f ON e.`id`=f.`uom_id`
			LEFT JOIN loccana_masterdata.`item_price` g ON c.id=g.item_id 
  </sql>
    <result outputType="json">{
       "data_not_filtered":{
            "countid":"$countid"
       }
  }
  </result>
  </query>
<!--   END QUERY LOCCANA SELLING REPORT -->

<!-- BEGIN QUERY LOCCANA SELING DETAILS -->
  <query id="createSellingDetailsQuery" keyColumns="id" returnGeneratedKeys="true" useConfig="DataSourceSelling">
    <sql>INSERT INTO selling_details (selling_id,item_id,unit_price,qty,qty_box,qty_satuan,box_amount,price,discount,notes,mutation_id,created_at,updated_at)
	values (:selling_id,:item_id,:unit_price,:qty,:qty_box,:qty_satuan,:box_amount,:price,:discount,:notes,:mutation_id,:created_at,:updated_at)</sql>
    <param name="selling_id" sqlType="STRING" />
    <param name="item_id" sqlType="STRING" />
    <param name="unit_price" sqlType="STRING" />
    <param name="qty" sqlType="STRING" />
    <param name="qty_box" sqlType="STRING" />
    <param name="qty_satuan" sqlType="STRING" />
    <param name="box_amount" sqlType="STRING" />
    <param name="price" sqlType="STRING" />
    <param name="discount" sqlType="STRING" />
    <param name="notes" sqlType="STRING" />
    <param name="mutation_id" sqlType="STRING" />
    <param name="created_at" sqlType="STRING" />
    <param name="updated_at" sqlType="STRING" />
    <result element="return" useColumnNumbers="true">
      <element name="id" column="1" xsdType="integer" />
    </result>
  </query>
  <query id="getSellingDetailsDetailQuery" useConfig="DataSourceSelling">
    <sql>
    SELECT 
   		id, 
   		selling_id, 
   		item_id, 
   		unit_price, 
   		qty, 
   		qty_box, 
   		qty_satuan, 
   		box_amount, 
   		price, 
   		discount, 
   		notes, 
   		mutation_id, 
   		DATE_FORMAT(created_at, "%Y-%m-%d %H:%i:%s") AS created_at,
	  DATE_FORMAT(updated_at, "%Y-%m-%d %H:%i:%s") AS updated_at
   	from selling_details
   	where id =:id
   	</sql>
    <param name="id" sqlType="STRING" paramType="SCALAR" />
    <result outputType="json">{
   "data":{
            "id":"$id",
            "selling_id":"$selling_id", 
	   		"item_id":"$item_id", 
	   		"unit_price":"$unit_price", 
	   		"qty":"$qty", 
	   		"qty_box":"$qty_box", 
	   		"qty_satuan":"$qty_satuan", 
	   		"box_amount":"$box_amount", 
	   		"price":"$price", 
	   		"discount":"$discount", 
	   		"notes":"$notes", 
	   		"mutation_id":"$mutation_id", 
	   		"created_at":"$created_at", 
	   		"updated_at":"$updated_at"
   }
}</result>
  </query>
  <query id="getSellingIDforUpdateItemQuery" useConfig="DataSourceSelling">
    <sql>
    SELECT 
   		selling_id, a.id as item_id   		
   	from loccana_selling.selling_details
   	left join loccana_masterdata.items AS a on a.id = loccana_selling.selling_details.item_id
   	where selling_id =:selling_id
   	</sql>
    <param name="selling_id" sqlType="STRING" paramType="SCALAR" />
    <param name="item_id" sqlType="STRING" paramType="SCALAR" />
    <result outputType="json">{
   "data":{
            "selling_id":"$selling_id",
            "item_id":"$item_id"	   		
   }
}</result>
  </query>
  <query id="updateItemQtyQuery" useConfig="DataSourceSelling" returnUpdatedRowCount="true">
    <sql>
    	UPDATE loccana_masterdata.items
  JOIN loccana_masterdata.item_qty ON  loccana_masterdata.items.id=loccana_masterdata.item_qty.item_id
  JOIN loccana_masterdata.item_price ON loccana_masterdata.items.id=loccana_masterdata.item_price.item_id
  JOIN loccana_selling.selling_details ON loccana_masterdata.items.id=loccana_selling.selling_details.item_id
  SET 
  loccana_masterdata.item_qty.base_qty = loccana_masterdata.item_qty.base_qty - loccana_selling.selling_details.qty

  WHERE loccana_selling.selling_details.selling_id= :id AND loccana_masterdata.items.id  = :item_id
    </sql>
    <param name="base_qty" sqlType="STRING" paramType="SCALAR" />
    <param name="qty" sqlType="STRING" paramType="SCALAR" />
    <param name="id" sqlType="STRING" paramType="SCALAR" />
    <param name="item_id" sqlType="STRING" paramType="SCALAR" />
    <result element="UpdatedRowCount" useColumnNumbers="true">
      <element name="id" column="1" xsdType="integer" />
    </result>
  </query>
<!--   END QUERY LOCCANA SELLING DETAILS -->
  
  <!-- BEGIN QUERY LOCCANA SELLING HISTORY -->
  <query id="createSellingHistoryQuery" keyColumns="id" returnGeneratedKeys="true" useConfig="DataSourceSelling">
    <sql>INSERT INTO `selling_history` (`selling_id`,`sales_id`,`item_id`,`unit_price`,`qty`,`qty_box`,`qty_pcs`,`box_amount`,`price`,`notes`,`mutation_id`,`approval_by`,`approval_date`,`created_at`,`updated_at`)
	values (:selling_id,:sales_id,:item_id,:unit_price,:qty,:qty_box,:qty_pcs,:box_amount,:price,:notes,:mutation_id,:approval_by,:approval_date,:created_at,:updated_at)
	</sql>
    <param name="selling_id" sqlType="STRING" paramType="SCALAR" />
    <param name="sales_id" sqlType="STRING" paramType="SCALAR" />
    <param name="item_id" sqlType="STRING" paramType="SCALAR" />
    <param name="unit_price" sqlType="STRING" paramType="SCALAR" />
    <param name="qty" sqlType="STRING" paramType="SCALAR" />
    <param name="qty_box" sqlType="STRING" paramType="SCALAR" />
    <param name="qty_pcs" sqlType="STRING" paramType="SCALAR" />
    <param name="box_amount" sqlType="STRING" paramType="SCALAR" />
    <param name="price" sqlType="STRING" paramType="SCALAR" />
    <param name="notes" sqlType="STRING" paramType="SCALAR" />
    <param name="mutation_id" sqlType="STRING" paramType="SCALAR" />
    <param name="approval_by" sqlType="STRING" paramType="SCALAR" />
    <param name="approval_date" sqlType="STRING" paramType="SCALAR" />
    <param name="created_at" sqlType="STRING" paramType="SCALAR" />
    <param name="updated_at" sqlType="STRING" paramType="SCALAR" />
    <result element="return" useColumnNumbers="true">
      <element name="id" column="1" xsdType="integer" />
    </result>
  </query>
  <query id="getSellingHistoryDetailQuery" useConfig="DataSourceSelling">
    <sql>
    SELECT 
	    `selling_id`,
	    `sales_id`,
	    `item_id`,
	    `unit_price`,
	    `qty`,
	    `qty_box`,
	    `qty_pcs`,
	    `box_amount`,
	    `price`,
	    `notes`,
	    `mutation_id`,
	    `approval_by`,
	    DATE_FORMAT(approval_date, "%Y-%m-%d %H:%i:%s") AS approval_date,
	    DATE_FORMAT(created_at, "%Y-%m-%d %H:%i:%s") AS created_at,
	  	DATE_FORMAT(updated_at, "%Y-%m-%d %H:%i:%s") AS updated_at 
	    FROM 
	    selling_history 
    WHERE 
    	id = :id</sql>
    <param name="id" sqlType="STRING" paramType="SCALAR" />
    <result outputType="json">{
   "data":{
            "selling_id":"$selling_id",
            "sales_id":"$sales_id",
            "item_id":"$item_id",
            "unit_price":"$unit_price",
            "qty":"$qty",
            "qty_box":"$qty_box",
            "qty_pcs":"$qty_pcs",
            "box_amount":"$box_amount",
            "price":"$price",
            "notes":"$notes",
            "mutation_id":"$mutation_id",
            "approval_by":"$approval_by",
            "approval_date":"$approval_date",
            "created_at":"$created_at",
            "updated_at":"$updated_at"
   }
}</result>
  </query>
  <query id="deleteSellingHistoryQuery" useConfig="DataSourceSelling" returnUpdatedRowCount="true">
    <sql>DELETE FROM selling_history where id = :id</sql>
    <result element="UpdatedRowCount" useColumnNumbers="true" rowName="">
      <element name="id" column="1" xsdType="integer" />
    </result>
    <param name="id" sqlType="STRING" />
  </query>
<!--   END QUERY LOCCANA SELLING HISTORY -->

<!-- BEGIN QUERY LOCCANA SELLING INVOICE   -->
<query id="getLimitOffsetSellingInvoiceQuery" useConfig="DataSourceSelling">
    <sql>
		SELECT 
			h.`id` AS id_invoice,
			DATE_FORMAT(h.`date_invoice`, "%Y-%m-%d %H:%i:%s") AS date_invoice,
			DATE_FORMAT(h.`due_date`,  "%Y-%m-%d %H:%i:%s") AS due_date,
			h.`invoice_number`,
			h.`notes`,
			h.`sign`,
			h.`tax_invoice`,
			h.notes as description,
			c.name,
			c.address,
			c.phone,
			c.email,
			h.status,
			i.`qty`,
			i.`qty_box`,
			i.`qty_pcs`,
			i.`discount`,
			i.`price`,
			i.`unit_price`,
			a.no_selling,
			DATE_FORMAT(a.date_selling, "%Y-%m-%d %H:%i:%s") AS date_selling
		FROM `loccana_selling`.`selling` a
		JOIN `loccana_selling`.`selling_details` b ON a.`id`=b.`selling_id`
		JOIN `loccana_selling`.`selling_invoice` e ON a.`id`=e.`selling_id`
		JOIN `loccana_masterdata`.`partners` c ON a.`partner_id`=c.`id`
		JOIN `loccana_masterdata`.`users` d ON a.`sales_id`=d.`id` 
		JOIN `loccana_masterdata`.`items` f ON b.`item_id`=f.id
		JOIN `loccana_masterdata`.`item_qty` g ON f.`id`=g.`item_id`
		JOIN `loccana_selling`.`selling_invoice` h ON a.id=h.selling_id
		JOIN `loccana_selling`.`selling_invoice_details` i ON b.`id`=i.`selling_detail_id`
		WHERE
		  a.status != 0
		  OR month (h.date_invoice) like CONCAT ('%', :month, '%')
		  OR year(h.date_invoice) like CONCAT('%', :year, '%')
		  OR (
		    h.invoice_number like CONCAT('%', :search, '%')
		    OR c.name like CONCAT('%', :search, '%')
		  )
		ORDER BY
		  h.`date_invoice` desc
		limit :limit
		offset :offset
	</sql>
    <param name="month" sqlType="STRING" paramType="SCALAR" />
    <param name="year" sqlType="STRING" paramType="SCALAR" />
    <param name="search" sqlType="STRING" paramType="SCALAR" />
    <param name="offset" sqlType="INTEGER" paramType="SCALAR" />
    <param name="limit" sqlType="INTEGER" paramType="SCALAR" />
    <result outputType="json">{
	"data":{
		"inovice": [
				{
						"id_invoice":"$id_invoice",
						"date_invoice":"$date_invoice",
						"due_date":"$due_date",
						"invoice_number":"$invoice_number",
						"notes":"$notes",
						"sign":"$sign",
						"tax_invoice":"$tax_invoice",
						"description":"$description",
						"name":"$name",
						"address":"$address",
						"phone":"$phone",
						"email":"$email",
						"status":"$status",
						"qty":"$qty",
						"qty_box":"$qty_box",
						"qty_pcs":"$qty_pcs",
						"discount":"$discount",
						"price":"$price",
						"unit_price":"$unit_price",
						"no_selling":"$no_selling",
						"date_selling":"$date_selling"
				}
			]
			
		}
}</result>
  </query>
  <query id="getsellingInvoiceCountSumPriceQuery" useConfig="DataSourceSelling">
    <sql>
	   			SELECT
					  COUNT(id) AS countid
					FROM
					  loccana_selling.selling_invoice AS a
				WHERE
				  a.status != 0
				  OR month (a.date_invoice) like CONCAT ('%' :month, '%')
				  OR year(a.date_invoice) like CONCAT('%', :year, '%')
				  OR (
				    a.invoice_number like CONCAT('%', :search, '%')
				  )    			
		</sql>
    <param name="month" sqlType="STRING" paramType="SCALAR" />
    <param name="year" sqlType="STRING" paramType="SCALAR" />
    <param name="search" sqlType="STRING" paramType="SCALAR" />
    <result outputType="json">
	    	{
			   "data":{
			            "countid":"$countid"
			   }
			}
		</result>
  </query>
  <query id="createSellingInvoicesQuery" keyColumns="id" returnGeneratedKeys="true" useConfig="DataSourceSelling">
    <sql>INSERT INTO selling_invoice 
    (selling_id,invoice_number,date_invoice,due_date,attention,notes,sign,tax_invoice,status,created_at,updated_at)
	VALUES 
	(:selling_id,:invoice_number,:date_invoice,:due_date,:attention,:notes,:sign,:tax_invoice,:status,:created_at,:updated_at)</sql>
    <param name="selling_id" sqlType="STRING" />
    <param name="invoice_number" sqlType="STRING" />
    <param name="date_invoice" sqlType="STRING" />
    <param name="due_date" sqlType="STRING" />
    <param name="attention" sqlType="STRING" />
    <param name="notes" sqlType="STRING" />
    <param name="sign" sqlType="STRING" />
    <param name="tax_invoice" sqlType="STRING" />
    <param name="status" sqlType="STRING" />
    <param name="created_at" sqlType="STRING" />
    <param name="updated_at" sqlType="STRING" />
    <result element="return" useColumnNumbers="true">
      <element name="id" column="1" xsdType="integer" />
    </result>
  </query>
  <query id="getSellingInvoicesListQuery" useConfig="DataSourceSelling">
    <sql>
    	SELECT 
	h.`id` AS id_invoice,
	DATE_FORMAT(h.`date_invoice`, "%Y-%m-%d %H:%i:%s") AS date_invoice,
	DATE_FORMAT(h.`due_date`, "%Y-%m-%d %H:%i:%s") AS due_date,
	h.`invoice_number`,
	h.`notes`,
	h.`sign`,
	h.`tax_invoice`,
	h.notes as description,
	c.name,
	c.address,
	c.phone,
	c.email,
	h.status,
	i.`qty`,
	i.`qty_box`,
	i.`qty_pcs`,
	i.`discount`,
	i.`price`,
	i.`unit_price`,
	a.no_selling,
	DATE_FORMAT(a.date_selling, "%Y-%m-%d %H:%i:%s") As date_selling
	FROM `loccana_selling`.`selling` a
	JOIN `loccana_selling`.`selling_details` b ON a.`id`=b.`selling_id`
	JOIN `loccana_selling`.`selling_invoice` e ON a.`id`=e.`selling_id`
	JOIN `loccana_masterdata`.`partners` c ON a.`partner_id`=c.`id`
	JOIN `loccana_masterdata`.`users` d ON a.`sales_id`=d.`id` 
	JOIN `loccana_masterdata`.`items` f ON b.`item_id`=f.id
	JOIN `loccana_masterdata`.`item_qty` g ON f.`id`=g.`item_id`
	JOIN `loccana_selling`.`selling_invoice` h ON a.id=h.selling_id
	JOIN `loccana_selling`.`selling_invoice_details` i ON b.`id`=i.`selling_detail_id` 
	GROUP BY h.`id` order by h.date_invoice desc
    </sql>
    <result outputType="json">{
	"data":{
		"selling_inovice": [
				{
						"id_invoice":"$id_invoice",
						"date_invoice":"$date_invoice",
						"due_date":"$due_date",
						"invoice_number":"$invoice_number",
						"notes":"$notes",
						"sign":"$sign",
						"tax_invoice":"$tax_invoice",
						"description":"$description",
						"name":"$name",
						"address":"$address",
						"phone":"$phone",
						"email":"$email",
						"status":"$status",
						"qty":"$qty",
						"qty_box":"$qty_box",
						"qty_pcs":"$qty_pcs",
						"discount":"$discount",
						"price":"$price",
						"unit_price":"$unit_price",
						"no_selling":"$no_selling",
						"date_selling":"$date_selling"
				}
			]
			
		}
}</result>
  </query>
  <query id="getSellingInvoicesDetailQuery" useConfig="DataSourceSelling">
    <sql>SELECT 
    id,
    selling_id, 
	invoice_number, 
	DATE_FORMAT(date_invoice, "%Y-%m-%d %H:%i:%s") AS date_invoice, 
	DATE_FORMAT(due_date, "%Y-%m-%d %H:%i:%s") AS due_date,  
	attention, 
	notes, 
	sign, 
	tax_invoice, 
	status, 
    DATE_FORMAT(created_at, "%Y-%m-%d %H:%i:%s") AS created_at,
	DATE_FORMAT(updated_at, "%Y-%m-%d %H:%i:%s") AS updated_at
    FROM selling_invoice WHERE id = :id</sql>
    <param name="id" sqlType="STRING" paramType="SCALAR" />
    <result outputType="json">{
   "data":{
            "id":"$id",
            "selling_id":"$selling_id",
            "invoice_number":"$invoice_number",
            "date_invoice":"$date_invoice",
            "due_date":"$due_date",
            "attention":"$attention",
            "notes":"$notes",
            "sign":"$sign",
            "tax_invoice":"$tax_invoice",
            "status":"$status",
            "created_at":"$created_at",
            "updated_at":"$updated_at"
   }
}</result>
  </query>
  <query id="updateSellingInvoicesQuery" useConfig="DataSourceSelling" returnUpdatedRowCount="true">
    <sql>
    	UPDATE `loccana_selling`.`selling` 
	LEFT JOIN `loccana_selling`.`selling_details` ON `loccana_selling`.`selling`.`id`=`loccana_selling`.`selling_details`.`selling_id`
	JOIN `loccana_masterdata`.`items` ON `loccana_selling`.`selling_details`.`item_id`=`loccana_masterdata`.`items`.`id`
	JOIN `loccana_masterdata`.`item_qty` ON `loccana_masterdata`.`items`.`id`=`loccana_masterdata`.`item_qty`.`item_id`
	JOIN `loccana_inventory`.`mutations` ON `loccana_selling`.`selling_details`.`mutation_id`=`loccana_inventory`.`mutations`.id
	LEFT JOIN `loccana_selling`.`selling_invoice` ON `loccana_selling`.`selling`.`id`=`loccana_selling`.`selling_invoice`.`selling_id`
	LEFT JOIN `loccana_selling`.`selling_invoice_details` ON `loccana_selling`.`selling_details`.`id`=`loccana_selling`.`selling_invoice_details`.`selling_detail_id`
	SET 
		invoice_number=:invoice_number,
		date_invoice=:date_invoice,
		due_date=:due_date,
		attention=:attention,
		sign=:sign,
		tax_invoice=:tax_invoice,
		loccana_selling.selling_invoice_details.unit_price=:unit_price,
		loccana_selling.selling_invoice_details.qty=:qty,
		loccana_selling.selling_invoice_details.qty_box=:qty_box,	
		loccana_selling.selling_invoice_details.qty_pcs=:qty_satuan,
		loccana_selling.selling_invoice_details.box_amount=:box_amount,
		loccana_selling.selling_invoice_details.price=:price,
		loccana_selling.selling_invoice_details.discount=:discount,
		loccana_selling.selling_invoice_details.notes=:notes,
		date_mutation=:date_mutation,
		amount_mutation=:amount_mutation,
		loccana_inventory.mutations.item_id=:item_id
		 WHERE
		 loccana_selling.selling_invoice.id=:id
    </sql>
    <param name="invoice_number" sqlType="STRING" paramType="SCALAR" />
    <param name="date_invoice" sqlType="STRING" paramType="SCALAR" />
    <param name="due_date" sqlType="STRING" paramType="SCALAR" />
    <param name="attention" sqlType="STRING" paramType="SCALAR" />
    <param name="sign" sqlType="STRING" paramType="SCALAR" />
    <param name="tax_invoice" sqlType="STRING" paramType="SCALAR" />
    <param name="qty" sqlType="STRING" paramType="SCALAR" />
    <param name="qty_box" sqlType="STRING" paramType="SCALAR" />
    <param name="qty_satuan" sqlType="STRING" paramType="SCALAR" />
    <param name="box_amount" sqlType="STRING" paramType="SCALAR" />
    <param name="unit_price" sqlType="STRING" paramType="SCALAR" />
    <param name="price" sqlType="STRING" paramType="SCALAR" />
    <param name="discount" sqlType="STRING" paramType="SCALAR" />
    <param name="notes" sqlType="STRING" paramType="SCALAR" />
    <param name="date_mutation" sqlType="STRING" paramType="SCALAR" />
    <param name="amount_mutation" sqlType="STRING" paramType="SCALAR" />
    <param name="item_id" sqlType="STRING" paramType="SCALAR" />
    <param name="id" sqlType="STRING" paramType="SCALAR" />
    <result element="UpdatedRowCount" useColumnNumbers="true">
      <element name="id" column="1" xsdType="integer" />
    </result>
  </query>
  <query id="deleteSellingInvoicesQuery" useConfig="DataSourceSelling" returnUpdatedRowCount="true">
    <sql>
    DELETE c,d,f
		FROM  `loccana_selling`.`selling_invoice` c
		LEFT JOIN `loccana_selling`.`selling_invoice_details` d ON c.id=d.`selling_invoice_id`
		LEFT JOIN `loccana_selling`.selling_details e ON d.`selling_detail_id`=e.`id`
		LEFT JOIN `loccana_inventory`.`mutations` f ON e.`mutation_id`=f.`id`
		WHERE c.id = :id
    
    </sql>
    <param name="id" sqlType="STRING" />
    <result element="UpdatedRowCount" useColumnNumbers="true" rowName="">
      <element name="id" column="1" xsdType="integer" />
    </result>
  </query>
  <query id="getSellingInvoicesIDQuery" useConfig="DataSourceSelling">
    <sql>
    SELECT 
	    id, 
	    selling_id, 
	    invoice_number, 
	    DATE_FORMAT(date_invoice, "%Y-%m-%d %H:%i:%s") AS date_invoice, 
	    DATE_FORMAT(due_date, "%Y-%m-%d %H:%i:%s") AS due_date, 
	    attention, 
	    notes, 
	    sign, 
	    tax_invoice, 
	    DATE_FORMAT(created_at, "%Y-%m-%d %H:%i:%s") AS created_at,
	  	DATE_FORMAT(updated_at, "%Y-%m-%d %H:%i:%s") AS updated_at 
    FROM 
    selling_invoice WHERE status = 0 AND id = :id
    </sql>
    <param name="id" sqlType="STRING" paramType="SCALAR" />
    <result outputType="json">{
   "data":{
            "id":"$id",
            "selling_id": "$selling_id",
            "invoice_number":"$invoice_number",
            "date_invoice": "$date_invoice",
            "due_date": "$due_date",
            "attention": "$attention",
            "notes": "$notes",
            "sign": "$sign",
            "tax_invoice": "$tax_invoice",
            
            "created_at":"$created_at",
            "updated_at":"$updated_at"
   }
}</result>
  </query>
  <query id="getSellingInvoicesSearchIDQuery" useConfig="DataSourceSelling">
    <sql>
    SELECT 
	a.id as selling_id,
	a.`no_selling`,
	DATE_FORMAT(a.`date_selling`, "%Y-%m-%d %H:%i:%s") AS date_selling,
	a.term_of_payment,
	b.id as selling_detail_id,
	c.`name`,
	c.`address`,
	c.`phone`,
	c.`email`,
	c.`ship_address`,
	c.`fax`,
	a.`term_of_payment` AS term_of_payment1,
	IFNULL(a.`description`, " ") AS `description`,
	f.`item_code`,
	f.`item_name`,
	f.id AS item_id,
	f.vat,
	h.`invoice_number`,
	DATE_FORMAT(h.date_invoice, "%Y-%m-%d %H:%i:%s") AS date_invoice,
	DATE_FORMAT(h.due_date, "%Y-%m-%d %H:%i:%s") AS due_date,
	h.`id` AS id_invoice,
	h.`attention`,
	h.`notes` AS description1,
	h.`sign`,
	h.`tax_invoice`,
	i.id AS selling_invoice_detail_id,
	i.`box_amount`,
	i.`discount`,
	i.`qty`,
	i.qty_pcs AS qty_satuan,
	i.`qty_box`,
	i.`price`,
	i.`unit_price`,
	i.notes,
	g.`unit_box` AS qty_per_box,
	g.base_qty AS stock
	FROM `loccana_selling`.`selling` a
	JOIN `loccana_selling`.`selling_details` b ON a.`id`=b.`selling_id`
	JOIN `loccana_masterdata`.`partners` c ON a.`partner_id`=c.`id`
	JOIN `loccana_masterdata`.`users` d ON a.`sales_id`=d.`id` 
	JOIN `loccana_masterdata`.`items` f ON b.`item_id`=f.id
	JOIN `loccana_masterdata`.`item_qty` g ON f.`id`=g.`item_id`
	JOIN `loccana_selling`.`selling_invoice_details` i ON b.`id`=i.`selling_detail_id`
	JOIN `loccana_selling`.`selling_invoice` h ON i.`selling_invoice_id`=h.`id`
	WHERE  h.id= :id
    </sql>
    <param name="id" sqlType="STRING" paramType="SCALAR" />
    <result outputType="json">{
	"data":{
		"selling_inovice": [
				{
					"selling_id":"$selling_id",
					"no_selling":"$no_selling",
					"date_selling":"$date_selling",
					"term_of_payment":"$term_of_payment",
					"selling_detail_id":"$selling_detail_id",
					"name":"$name",
					"address":"$address",
					"phone":"$phone",
					"email":"$email",
					"ship_address":"$ship_address",
					"fax":"$fax",
					"term_of_payment1":"$term_of_payment1",
					"description":"$description",
					"item_code":"$item_code",
					"item_name":"$item_name",
					"item_id":"$item_id",
					"vat":"$vat",
					"invoice_number":"$invoice_number",
					"date_invoice":"$date_invoice",
					"due_date":"$due_date",
					"id_invoice":"$id_invoice",
					"attention":"$attention",
					"description1":"$description1",
					"sign":"$sign",
					"tax_invoice":"$tax_invoice",
					"selling_invoice_detail_id":"$selling_invoice_detail_id",
					"box_amount":"$box_amount",
					"discount":"$discount",
					"qty":"$qty",
					"qty_satuan":"$qty_satuan",
					"qty_box":"$qty_box",
					"price":"$price",
					"unit_price":"$unit_price",
					"notes":"$notes",
					"qty_per_box":"$qty_per_box",
					"stock":"$stock"
				}
			]
			
		}
}</result>
  </query>
<!--   END QUERY LOCCANA SELLING INVOICE -->

<!-- BEGIN QUERY LOCCANA SELLING INVOICE DETAILS -->
  <query id="createSellingInvoiceDetailsQuery" keyColumns="id" returnGeneratedKeys="true" useConfig="DataSourceSelling">
    <sql>INSERT INTO selling_invoice_details 
    (selling_invoice_id,selling_detail_id,unit_price,qty,
    qty_box,qty_pcs,box_amount,price,discount,notes,created_at,updated_at)
	values 
	(:selling_invoice_id,:selling_detail_id,:unit_price,:qty,
	:qty_box,:qty_pcs,:box_amount,:price,:discount,:notes,:created_at,:updated_at)
	</sql>
    <param name="selling_invoice_id" sqlType="STRING" paramType="SCALAR" />
    <param name="selling_detail_id" sqlType="STRING" paramType="SCALAR" />
    <param name="unit_price" sqlType="STRING" paramType="SCALAR" />
    <param name="qty" sqlType="STRING" paramType="SCALAR" />
    <param name="qty_box" sqlType="STRING" paramType="SCALAR" />
    <param name="qty_pcs" sqlType="STRING" paramType="SCALAR" />
    <param name="box_amount" sqlType="STRING" paramType="SCALAR" />
    <param name="price" sqlType="STRING" paramType="SCALAR" />
    <param name="discount" sqlType="STRING" paramType="SCALAR" />
    <param name="notes" sqlType="STRING" paramType="SCALAR" />
    <param name="created_at" sqlType="STRING" paramType="SCALAR" />
    <param name="updated_at" sqlType="STRING" paramType="SCALAR" />
    <result element="return" useColumnNumbers="true">
      <element name="id" column="1" xsdType="integer" />
    </result>
  </query>
<!--   END QUERY LOCCANA SELLING INVOICE DETAIL -->

<!-- BEGIN QUERY LOCCANA SELLING RETURN -->
<query id="getLimitOffsetSellingReturnQuery" useConfig="DataSourceSelling">
    <sql>
		SELECT 
		a.`id`,
		a.`invoice_number`,
		DATE_FORMAT(a.`date_invoice`, "%Y-%m-%d %H:%i:%s") AS date_invoice,
		DATE_FORMAT(a.`due_date`, "%Y-%m-%d %H:%i:%s") AS due_date,
		a.`sign`,
		a.`tax_invoice`,
		a.`notes`,
		b.`qty`,
		b.`unit_price`,
		b.`price`,
		f.`name`,
		c.`id` AS id_return,
		DATE_FORMAT(c.`retur_date`, "%Y-%m-%d %H:%i:%s") AS retur_date,
		c.`status`,		
		DATE_FORMAT(e.`date_selling`, "%Y-%m-%d %H:%i:%s") AS date_selling,
		e.`no_selling`,
		d.`qty_return` 
	FROM `loccana_selling`.`selling_invoice` a
	JOIN `loccana_selling`.`selling_invoice_details` b ON a.`id`=b.`selling_invoice_id`
	JOIN `loccana_selling`.`selling_returns` c ON a.`id`=c.`selling_invoice_id`
	JOIN `loccana_selling`.`selling_return_details` d ON c.`id`=d.`selling_return_id`
	JOIN `loccana_selling`.`selling` e ON a.`selling_id`=e.`id`
	JOIN `loccana_masterdata`.`partners` f ON e.`partner_id`=f.`id`
		WHERE
		  a.status != 0
		  OR month (c.retur_date) like CONCAT ('%', :month, '%')
		  OR year(c.retur_date) like CONCAT('%', :year, '%')
		  OR (
		    e.no_selling like CONCAT('%', :search, '%')
		    OR f.name like CONCAT('%', :search, '%')
		  )
		ORDER BY
		  c.retur_date desc
		limit :limit
		offset :offset
	</sql>
    <param name="month" sqlType="STRING" paramType="SCALAR" />
    <param name="year" sqlType="STRING" paramType="SCALAR" />
    <param name="search" sqlType="STRING" paramType="SCALAR" />
    <param name="offset" sqlType="INTEGER" paramType="SCALAR" />
    <param name="limit" sqlType="INTEGER" paramType="SCALAR" />
    <result outputType="json">{
   "data":{
   		"return": [
		   		{
		   			"id": "$id", 
		   			"invoice_number" : "$invoice_number", 
		   			"date_invoice" : "$date_invoice", 
		   			"due_date" : "$due_date", 
		   			"sign" : "$sign", 
		   			"tax_invoice" : "$tax_invoice", 
		   			"notes" : "$notes", 
		   			"qty" : "$qty", 
		   			"unit_price" : "$unit_price", 
		   			"price" : "$price", 
		   			"name" : "$name", 
		   			"id_return" : "$id_return", 
		   			"retur_date" : "$retur_date", 
		   			"status" : "$status", 
		   			"date_selling": "$date_selling", 
		   			"no_selling" : "$no_selling", 
		   			"qty_return" : "$qty_return"
		   		}
   		 ]
   }
}</result>
  </query>
  <query id="getsellingReturnCountSumPriceQuery" useConfig="DataSourceSelling">
    <sql>
   			SELECT
				  COUNT(id) AS countid
				FROM
				  	loccana_selling.selling_returns AS a
				WHERE
				  a.status != 0
				  OR month (a.retur_date) like CONCAT ('%' :month, '%')
				  OR year(a.retur_date) like CONCAT('%', :year, '%')
				  OR (
				   a.notes like CONCAT('%', :search, '%')
				  )    			
		</sql>
    <param name="month" sqlType="STRING" paramType="SCALAR" />
    <param name="year" sqlType="STRING" paramType="SCALAR" />
    <param name="search" sqlType="STRING" paramType="SCALAR" />
    <result outputType="json">
	    	{
			   "data":{
			            "countid":"$countid"
			   }
			}
		</result>
  </query>
  <query id="createSellingReturnQuery" keyColumns="id" returnGeneratedKeys="true" useConfig="DataSourceSelling">
    <sql>
    insert into selling_returns (selling_invoice_id, selling_id, retur_date, notes, approved_by, created_at, updated_at)
			values (:selling_invoice_id,:selling_id,:retur_date,:notes,:approved_by,:created_at,:updated_at)
			</sql>
    <param name="selling_invoice_id" sqlType="STRING" />
    <param name="selling_id" sqlType="STRING" />
    <param name="retur_date" sqlType="STRING" />
    <param name="notes" sqlType="STRING" />
    <param name="approved_by" sqlType="STRING" />
    <param name="created_at" sqlType="STRING" />
    <param name="updated_at" sqlType="STRING" />
    <result element="return" useColumnNumbers="true">
      <element name="id" column="1" xsdType="integer" />
    </result>
  </query>
  <query id="getSellingReturnDetailQuery" useConfig="DataSourceSelling">
    <sql>
    SELECT 
		a.id AS id_return, 
		b.`no_selling`,  
		DATE_FORMAT(b.`date_selling`, "%Y-%m-%d %H:%i:%s") AS sales_date, 
		c.`name`, 
		c.`address`,
		c.`phone`, 
		c.`email`, 
		DATE_FORMAT(a.`retur_date`, "%Y-%m-%d %H:%i:%s") AS retur_date, 
		a.`notes`,
        IFNULL(b.`description`, " ") AS keterangan_beli, 
        b.`term_of_payment`, 
        f.`item_code`, 
        f.`item_name`, 
        d.`qty_return` AS qty_return, 
        g.`unit_box`, 
        e.`qty` AS qty_order, 
        e.`id` AS selling_detail_id, 
        f.`id` AS item_id, 
        e.`unit_price`, 
        d.`id` AS selling_return_detail_id
       FROM selling_returns AS a JOIN selling AS b ON a.selling_id = b.id
               JOIN loccana_masterdata.partners AS c ON b.partner_id = c.id
                       JOIN selling_return_details AS d ON a.id = d.`selling_return_id`
                       JOIN selling_details AS e ON d.`selling_detail_id` = e.`id`
                       JOIN loccana_masterdata.`items` AS f ON e.`item_id` = f.`id`
                       JOIN loccana_masterdata.`item_qty` AS g ON f.`id` = g.`item_id`
                       WHERE a.id = :id
    </sql>
    <param name="id" sqlType="STRING" paramType="SCALAR" />
    <result outputType="json">{
   "data":{
            "id_return":"$id_return",
            "no_selling":"$no_selling",
            "sales_date":"$sales_date",
            "name":"$name",
            "address":"$address",
            "phone":"$phone",
            "email":"$email",
            "retur_date":"$retur_date",
            "notes":"$notes",
            "keterangan_beli":"$keterangan_beli",
            "term_of_payment":"$term_of_payment",
            "item_code":"$item_code",
            "item_name":"$item_name",
            "qty_return":"$qty_return",
            "unit_box":"$unit_box",
            "qty_order":"$qty_order",
            "selling_detail_id":"$selling_detail_id",
            "item_id":"$item_id",
            "unit_price":"$unit_price",
            "selling_return_detail_id":"$selling_return_detail_id"
   }
}
</result>
  </query>
  <query id="getListSellingReturnQuery" useConfig="DataSourceSelling">
    <sql>
	SELECT 
		a.`id`,
		a.`invoice_number`,
		DATE_FORMAT(a.`date_invoice`, "%Y-%m-%d %H:%i:%s") AS date_invoice,
		DAtE_FORMAT(a.`due_date`, "%Y-%m-%d %H:%i:%s") AS due_date,
		a.`sign`,
		a.`tax_invoice`,
		a.`notes`,
		b.`qty`,
		b.`unit_price`,
		b.`price`,
		f.`name`,
		c.`id` AS id_return,
		c.`retur_date`,
		c.`status`,		
		DATE_FORMAT(e.`date_selling`, "%Y-%m-%d %H:%i:%s") AS date_selling,
		e.`no_selling`,
		d.`qty_return` 
	FROM `loccana_selling`.`selling_invoice` a
	JOIN `loccana_selling`.`selling_invoice_details` b ON a.`id`=b.`selling_invoice_id`
	JOIN `loccana_selling`.`selling_returns` c ON a.`id`=c.`selling_invoice_id`
	JOIN `loccana_selling`.`selling_return_details` d ON c.`id`=d.`selling_return_id`
	JOIN `loccana_selling`.`selling` e ON a.`selling_id`=e.`id`
	JOIN `loccana_masterdata`.`partners` f ON e.`partner_id`=f.`id`
	GROUP BY c.`id` ORDER BY a.`date_invoice` DESC
    </sql>
    <result outputType="json">{
   "data":{
   		"data": [
		   		{
		   			"id": "$id", 
		   			"invoice_number" : "$invoice_number", 
		   			"date_invoice" : "$date_invoice", 
		   			"due_date" : "$due_date", 
		   			"sign" : "$sign", 
		   			"tax_invoice" : "$tax_invoice", 
		   			"notes" : "$notes", 
		   			"qty" : "$qty", 
		   			"unit_price" : "$unit_price", 
		   			"price" : "$price", 
		   			"name" : "$name", 
		   			"id_return" : "$id_return", 
		   			"retur_date" : "$retur_date", 
		   			"status" : "$status", 
		   			"date_selling": "$date_selling", 
		   			"no_selling" : "$no_selling", 
		   			"qty_return" : "$qty_return"
		   		}
   		 ]
   }
}
</result>
  </query>
  <query id="deleteSellingReturnQuery" useConfig="DataSourceSelling" returnUpdatedRowCount="true">
    <sql>DELETE a,b
		FROM `loccana_selling`.`selling_returns` a
		JOIN `loccana_selling`.`selling_return_details` b ON a.`id`=b.`selling_return_id`
		WHERE a.id= :id</sql>
    <result element="UpdatedRowCount" useColumnNumbers="true" rowName="">
      <element name="id" column="1" xsdType="integer" />
    </result>
    <param name="updated_at" sqlType="STRING" />
    <param name="id" sqlType="STRING" />
  </query>
  <query id="ApproveSellingRetunQuery" useConfig="DataSourceSelling" returnUpdatedRowCount="true">
    <sql>
	    UPDATE
		  selling_returns
		  LEFT JOIN selling_return_details ON selling_returns.id = selling_return_details.selling_return_id
		SET
		  status = :status,
		  approved_by = :approved_by
		WHERE
		  selling_returns.id = :id
    </sql>
    <param name="status" sqlType="STRING" paramType="SCALAR" />
    <param name="approved_by" sqlType="STRING" paramType="SCALAR" />
    <param name="id" sqlType="STRING" paramType="SCALAR" />
    <result element="UpdatedRowCount" useColumnNumbers="true">
      <element name="id" column="1" xsdType="integer" />
    </result>
  </query>
  <query id="updateSellingRetunQuery" useConfig="DataSourceSelling" returnUpdatedRowCount="true">
    <sql>UPDATE `selling_returns`
	LEFT JOIN `selling_return_details` ON `selling_returns`.id = `selling_return_details`.`selling_return_id`
	SET 
		retur_date= :retur_date,
		notes= :notes,
		qty_return= :qty_return
		 WHERE
		 `selling_return_details`.id= :id
    </sql>
    <param name="retur_date" sqlType="STRING" paramType="SCALAR" />
    <param name="notes" sqlType="STRING" paramType="SCALAR" />
    <param name="qty_return" sqlType="STRING" paramType="SCALAR" />
    <param name="id" sqlType="STRING" paramType="SCALAR" />
    <result element="UpdatedRowCount" useColumnNumbers="true">
      <element name="id" column="1" xsdType="integer" />
    </result>
  </query>
<!--   END QUERY LOCCANA SELLING RETURN -->

<!-- BEGIN QUERY LOCCANA SELLING RETURN DETAIL -->
  <query id="createSellingReturnDetailsQuery" keyColumns="id" returnGeneratedKeys="true" useConfig="DataSourceSelling">
    <sql>
    INSERT INTO
    selling_return_details (
	    selling_return_id,
	    selling_detail_id,
	    qty_return,  
	    created_at,
		updated_at
	)
     VALUES (
	     :selling_return_id,
	     :selling_detail_id,
	     :qty_return,
	     :created_at,
	     :updated_at
     )</sql>
    <param name="selling_return_id" sqlType="STRING" />
    <param name="selling_detail_id" sqlType="STRING" />
    <param name="qty_return" sqlType="STRING" />
    <param name="created_at" sqlType="STRING" />
    <param name="updated_at" sqlType="STRING" />
    <result element="return" useColumnNumbers="true">
      <element name="id" column="1" xsdType="integer" />
    </result>
  </query>
  <query id="getSellingReturnDetailsDetailQuery" useConfig="DataSourceSelling">
    <sql>SELECT 
	    id,
	    selling_return_id,
	    selling_detail_id,
	    qty_return,
	    DATE_FORMAT(created_at, "%Y-%m-%d %H:%i:%s") AS created_at,
		DATE_FORMAT(updated_at, "%Y-%m-%d %H:%i:%s") AS updated_at 
	FROM
		selling_return_details 
	WHERE 
		id = :id
	</sql>
    <param name="id" sqlType="STRING" paramType="SCALAR" />
    <result outputType="json">{
   "data":{
            "id":"$id",
            "selling_return_id":"$selling_return_id",
            "selling_detail_id":"$selling_detail_id",
            "qty_return":"$qty_return",
            "created_at":"$created_at",
            "updated_at":"$updated_at"
   }
}</result>
  </query>
<!--   END QUERY LOCCANA SELLING RETURN DETAIL -->

<!-- BEGAN OPERATION USER ACTIVITIES FOR MASTERDATA -->
	<operation name="createUserActivities">
	    <call-query href="createUserActivitiesQuery">
	      <with-param name="id_user" query-param="id_user" />
	      <with-param name="menu" query-param="menu" />
	      <with-param name="aktivitas" query-param="aktivitas" />
	      <with-param name="keterangan" query-param="keterangan" />
	      <with-param name="created_at" query-param="created_at" />
	      <with-param name="updated_at" query-param="updated_at" />
	    </call-query>
	  </operation>
	  <operation name="getUserActivitiesDetail">
	    <call-query href="getUserActivitiesDetailQuery">
	      <with-param name="id" query-param="id" />
	    </call-query>
	  </operation>
<!-- 	  END OPERATION USER ACTIVITIES -->

<!-- BEGIN OPERATION LOCCANA SELLING -->
  <operation name="getLimitOffsetSelling">
    <call-query href="getLimitOffsetSellingQuery">
      <with-param name="month" query-param="month" />
      <with-param name="year" query-param="year" />
      <with-param name="search" query-param="search" />
      <with-param name="offset" query-param="offset" />
      <with-param name="limit" query-param="limit" />
    </call-query>
  </operation>
  <operation name="getsellingCountSumPrice">
    <call-query href="getsellingCountSumPriceQuery">
      <with-param name="month" query-param="month" />
      <with-param name="year" query-param="year" />
      <with-param name="search" query-param="search" />
    </call-query>
  </operation>
  <operation name="createSellings">
    <call-query href="createSellingsQuery">
      <with-param name="sales_id" query-param="sales_id" />
      <with-param name="no_selling" query-param="no_selling" />
      <with-param name="date_selling" query-param="date_selling" />
      <with-param name="delivery_date" query-param="delivery_date" />
      <with-param name="partner_id" query-param="partner_id" />
      <with-param name="term_of_payment" query-param="term_of_payment" />
      <with-param name="total_amount" query-param="total_amount" />
      <with-param name="coa_id" query-param="coa_id" />
      <with-param name="payment_coa" query-param="payment_coa" />
      <with-param name="currency_id" query-param="currency_id" />
      <with-param name="rate" query-param="rate" />
      <with-param name="tax" query-param="tax" />
      <with-param name="seq_n" query-param="seq_n" />
      <with-param name="created_at" query-param="created_at" />
      <with-param name="updated_at" query-param="updated_at" />
    </call-query>
  </operation>
  <operation name="getSellingsDetail">
    <call-query href="getSellingsDetailQuery">
      <with-param name="id" query-param="id" />
    </call-query>
  </operation>
  <operation name="deleteSellings">
    <call-query href="deleteSellingsQuery">
      <with-param name="id" query-param="id" />
    </call-query>
  </operation>
  <operation name="getSellingsList">
    <call-query href="getSellingsListQuery" />
  </operation>
  <operation name="updateSellings">
    <call-query href="updateSellingsQuery">
      <with-param name="date_selling" query-param="date_selling" />
      <with-param name="term_of_payment" query-param="term_of_payment" />
      <with-param name="delivery_date" query-param="delivery_date" />
      <with-param name="total_amount" query-param="total_amount" />
      <with-param name="unit_price" query-param="unit_price" />
      <with-param name="item_idA" query-param="item_idA" />
      <with-param name="qty" query-param="qty" />
      <with-param name="qty_box" query-param="qty_box" />
      <with-param name="qty_satuan" query-param="qty_satuan" />
      <with-param name="box_amount" query-param="box_amount" />
      <with-param name="price" query-param="price" />
      <with-param name="discount" query-param="discount" />
      <with-param name="notes" query-param="notes" />
      <with-param name="date_mutation" query-param="date_mutation" />
      <with-param name="amount_mutation" query-param="amount_mutation" />
      <with-param name="item_id" query-param="item_id" />
      <with-param name="id" query-param="id" />
    </call-query>
  </operation>
  <operation name="getSellingsId">
    <call-query href="getSellingsIdQuery">
      <with-param name="id" query-param="id" />
    </call-query>
  </operation>
  <operation name="approveSellings">
    <call-query href="approveSellingsQuery">
      <with-param name="status" query-param="status" />
      <with-param name="approval_date" query-param="approval_date" />
      <with-param name="approved_by" query-param="approved_by" />
      <with-param name="id" query-param="id" />
    </call-query>
  </operation>
<!--   END OPERATION LOCCANA SELLING -->

<!-- BEGIN OPERATION LOCCANA SELLING REPORT -->
<operation name="getSellingReport">
    <call-query href="getSellingReportQuery">
      <with-param name="search" query-param="search" />
      <with-param name="limit" query-param="limit" />
      <with-param name="offset" query-param="offset" />
    </call-query>
  </operation>
  <operation name="getSellingReportNotFiltered">
    <call-query href="getSellingReportNotFilteredQuery">
      <with-param name="limit" query-param="limit" />
      <with-param name="offset" query-param="offset" />
    </call-query>
  </operation>
  <operation name="getSelingReportCount">
    <call-query href="getSelingReportCountQuery">
      <with-param name="search" query-param="search" />
    </call-query>
  </operation>
  <operation name="getSellingReportCountNotFiltered">
    <call-query href="getSellingReportCountNotFilteredQuery">
    </call-query>
  </operation>
<!-- END OPERATION LOCCANA SELLING REPORT -->

<!-- BEGIN OPERATION LOCCANA SELLING DETAIL -->
  <operation name="getSellingIDforUpdateItem">
    <call-query href="getSellingIDforUpdateItemQuery">
      <with-param name="selling_id" query-param="selling_id" />
      <with-param name="item_id" query-param="item_id" />
    </call-query>
  </operation>
  <operation name="updateItemQty">
    <call-query href="updateItemQtyQuery">
      <with-param name="base_qty" query-param="base_qty" />
      <with-param name="qty" query-param="qty" />
      <with-param name="id" query-param="id" />
      <with-param name="item_id" query-param="id" />
    </call-query>
  </operation>
  <operation name="createSellingDetail_batch_req">
    <call-query href="createSellingDetailsQuery">
      <with-param name="selling_id" query-param="selling_id" />
      <with-param name="item_id" query-param="item_id" />
      <with-param name="unit_price" query-param="unit_price" />
      <with-param name="qty" query-param="qty" />
      <with-param name="qty_box" query-param="qty_box" />
      <with-param name="qty_satuan" query-param="qty_satuan" />
      <with-param name="box_amount" query-param="box_amount" />
      <with-param name="price" query-param="price" />
      <with-param name="discount" query-param="discount" />
      <with-param name="notes" query-param="notes" />
      <with-param name="mutation_id" query-param="mutation_id" />
      <with-param name="created_at" query-param="created_at" />
      <with-param name="updated_at" query-param="updated_at" />
    </call-query>
  </operation>
  <operation name="getSellingDetailsDetail">
    <call-query href="getSellingDetailsDetailQuery">
      <with-param name="id" query-param="id" />
    </call-query>
  </operation>
<!--   END OPERATION LOCCANA SELLING DETAIL -->

<!-- BEGIN OPERATION LOCCANA SELLING HISTORY -->
  <operation name="getSellingHistoryDetail">
    <call-query href="getSellingHistoryDetailQuery">
      <with-param name="id" query-param="id" />
    </call-query>
  </operation>
  <operation name="deleteSellingHistory">
    <call-query href="deleteSellingHistoryQuery">
      <with-param name="id" query-param="id" />
    </call-query>
  </operation>
  <operation name="createSellingHistory">
    <call-query href="createSellingHistoryQuery">
      <with-param name="selling_id" query-param="selling_id" />
      <with-param name="sales_id" query-param="sales_id" />
      <with-param name="item_id" query-param="item_id" />
      <with-param name="unit_price" query-param="unit_price" />
      <with-param name="qty" query-param="qty" />
      <with-param name="qty_box" query-param="qty_box" />
      <with-param name="qty_pcs" query-param="qty_pcs" />
      <with-param name="box_amount" query-param="box_amount" />
      <with-param name="price" query-param="price" />
      <with-param name="notes" query-param="notes" />
      <with-param name="mutation_id" query-param="mutation_id" />
      <with-param name="approval_by" query-param="approval_by" />
      <with-param name="approval_date" query-param="approval_date" />
      <with-param name="created_at" query-param="created_at" />
      <with-param name="updated_at" query-param="updated_at" />
    </call-query>
  </operation>
<!--   END OPERATION LOCCANA SELLING HISTORY -->

<!-- BEGIN OPERATION LOCCANA SELLING INVOICE -->
  <operation name="getLimitOffsetSellingInvoice">
    <call-query href="getLimitOffsetSellingInvoiceQuery">
      <with-param name="month" query-param="month" />
      <with-param name="year" query-param="year" />
      <with-param name="search" query-param="search" />
      <with-param name="offset" query-param="offset" />
      <with-param name="limit" query-param="limit" />
    </call-query>
  </operation>
  <operation name="getsellingInvoiceCountSumPrice">
    <call-query href="getsellingInvoiceCountSumPriceQuery">
      <with-param name="month" query-param="month" />
      <with-param name="year" query-param="year" />
      <with-param name="search" query-param="search" />
    </call-query>
  </operation>
  <operation name="createSellingInvoices">
    <call-query href="createSellingInvoicesQuery">
      <with-param name="selling_id" query-param="selling_id" />
      <with-param name="invoice_number" query-param="invoice_number" />
      <with-param name="date_invoice" query-param="date_invoice" />
      <with-param name="due_date" query-param="due_date" />
      <with-param name="attention" query-param="attention" />
      <with-param name="notes" query-param="notes" />
      <with-param name="sign" query-param="sign" />
      <with-param name="tax_invoice" query-param="tax_invoice" />
      <with-param name="status" query-param="status" />
      <with-param name="created_at" query-param="created_at" />
      <with-param name="updated_at" query-param="updated_at" />
    </call-query>
  </operation>
  <operation name="getSellingInvoicesList">
    <call-query href="getSellingInvoicesListQuery" />
  </operation>
  <operation name="getSellingInvoicesDetail">
    <call-query href="getSellingInvoicesDetailQuery">
      <with-param name="id" query-param="id" />
    </call-query>
  </operation>
  <operation name="updateSellingInvoices">
    <call-query href="updateSellingInvoicesQuery">
      <with-param name="invoice_number" query-param="invoice_number" />
      <with-param name="date_invoice" query-param="date_invoice" />
      <with-param name="due_date" query-param="due_date" />
      <with-param name="attention" query-param="attention" />
      <with-param name="sign" query-param="sign" />
      <with-param name="tax_invoice" query-param="tax_invoice" />
      <with-param name="qty" query-param="qty" />
      <with-param name="qty_box" query-param="qty_box" />
      <with-param name="qty_satuan" query-param="qty_satuan" />
      <with-param name="box_amount" query-param="box_amount" />
      <with-param name="unit_price" query-param="unit_price" />
      <with-param name="price" query-param="price" />
      <with-param name="discount" query-param="discount" />
      <with-param name="notes" query-param="notes" />
      <with-param name="date_mutation" query-param="date_mutation" />
      <with-param name="amount_mutation" query-param="amount_mutation" />
      <with-param name="item_id" query-param="item_id" />
      <with-param name="id" query-param="id" />
    </call-query>
  </operation>
  <operation name="deleteSellingInvoices">
    <call-query href="deleteSellingInvoicesQuery">
      <with-param name="id" query-param="id" />
    </call-query>
  </operation>
  <operation name="getSellingInvoicesID">
    <call-query href="getSellingInvoicesIDQuery">
      <with-param name="id" query-param="id" />
    </call-query>
  </operation>
  <operation name="getSellingInvoicesSearchID">
    <call-query href="getSellingInvoicesSearchIDQuery">
      <with-param name="id" query-param="id" />
    </call-query>
  </operation>
<!--   END OPERATION LOCCANA SELLING INVOICE -->

<!-- BEGIN OPERATION LOCCANA SELLING INVOICE DETAIL -->
  <operation name="createSellingInvoiceDetail_batch_req">
    <call-query href="createSellingInvoiceDetailsQuery">
      <with-param name="selling_invoice_id" query-param="selling_invoice_id" />
      <with-param name="selling_detail_id" query-param="selling_detail_id" />
      <with-param name="unit_price" query-param="unit_price" />
      <with-param name="qty" query-param="qty" />
      <with-param name="qty_box" query-param="qty_box" />
      <with-param name="qty_pcs" query-param="qty_pcs" />
      <with-param name="box_amount" query-param="box_amount" />
      <with-param name="price" query-param="price" />
      <with-param name="discount" query-param="discount" />
      <with-param name="notes" query-param="notes" />
      <with-param name="created_at" query-param="created_at" />
      <with-param name="updated_at" query-param="updated_at" />
    </call-query>
  </operation>
<!--   END OPERATION LOCCANA SELLING INVOICE DETAIL  -->

<!-- BEGIN OPERATION LOCCANA SELLING RETURN -->
<operation name="getLimitOffsetSellingReturn">
    <call-query href="getLimitOffsetSellingReturnQuery">
      <with-param name="month" query-param="month" />
      <with-param name="year" query-param="year" />
      <with-param name="search" query-param="search" />
      <with-param name="offset" query-param="offset" />
      <with-param name="limit" query-param="limit" />
    </call-query>
  </operation>
  <operation name="getsellingReturnCountSumPrice">
    <call-query href="getsellingReturnCountSumPriceQuery">
      <with-param name="month" query-param="month" />
      <with-param name="year" query-param="year" />
      <with-param name="search" query-param="search" />
    </call-query>
  </operation>
  <operation name="createSellingReturn">
    <call-query href="createSellingReturnQuery">
      <with-param name="selling_invoice_id" query-param="selling_invoice_id" />
      <with-param name="selling_id" query-param="selling_id" />
      <with-param name="retur_date" query-param="retur_date" />
      <with-param name="notes" query-param="notes" />
      <with-param name="approved_by" query-param="approved_by" />
      <with-param name="created_at" query-param="created_at" />
      <with-param name="updated_at" query-param="updated_at" />
    </call-query>
  </operation>
  <operation name="getSellingReturnDetail">
    <call-query href="getSellingReturnDetailQuery">
      <with-param name="id" query-param="id" />
    </call-query>
  </operation>
  <operation name="deleteSellingReturn">
    <call-query href="deleteSellingReturnQuery">
      <with-param name="updated_at" query-param="updated_at" />
      <with-param name="id" query-param="id" />
    </call-query>
  </operation>
  <operation name="ApproveSellingReturn">
    <call-query href="ApproveSellingRetunQuery">
      <with-param name="status" query-param="status" />
      <with-param name="approved_by" query-param="approved_by" />
      <with-param name="id" query-param="id" />
    </call-query>
  </operation>
  <operation name="getListSellingReturn">
    <call-query href="getListSellingReturnQuery" />
  </operation>
  <operation name="updateSellingReturn">
    <call-query href="updateSellingRetunQuery">
      <with-param name="retur_date" query-param="retur_date" />
      <with-param name="notes" query-param="notes" />
      <with-param name="qty_return" query-param="qty_return" />
      <with-param name="id" query-param="id" />
    </call-query>
  </operation>
<!--   END OPERATION LOCCANA SELLING RETURN -->
  
<!--   BEGIN OPERATION LOCCANA SELLING RETURN DETAIL -->
  <operation name="createSellingReturnDetail_batch_req">
    <call-query href="createSellingReturnDetailsQuery">
      <with-param name="selling_return_id" query-param="selling_return_id" />
      <with-param name="selling_detail_id" query-param="selling_detail_id" />
      <with-param name="qty_return" query-param="qty_return" />
      <with-param name="created_at" query-param="created_at" />
      <with-param name="updated_at" query-param="updated_at" />
    </call-query>
  </operation>
  <operation name="getSellingReturnDetailsDetail">
    <call-query href="getSellingReturnDetailsDetailQuery">
      <with-param name="id" query-param="id" />
    </call-query>
  </operation>
<!--   END OPERATION LOCCANA SELLING RETURN DETAIL -->
</data>
